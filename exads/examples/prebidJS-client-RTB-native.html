<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <title>Prebid.js</title>
    <!-- Uncomment for development environments -->
    <!-- <script src='js/prebid.js'></script> -->
    <!-- Uncomment for production environments -->
    <script async src='js/prebid.js' onload='onScriptLoaded()'></script>
    <script>
        // Client Conf start
        // Set as true for development environments only
        const isEnabledDebug = false;
        const exadsEndpoint = 'https://your-ad-network.com/rtb.php';
        let zoneId = 5208093;
        let fid = '21352c8fa2f3649fdd2b01d550aa0d1fd183926c';
        const partner = 'ortb_2_4';

        // Start GDPR params
        let isGDPRRequested = false;
        // Valid iabtcf consent string 
        let consentString = 'CO_V33gP0l1PgAoAAAENCZCgAAAAAAAAAAAAE0wAQE0gTTABATSAAA.YAAAAAAAAAA';
        // End GDPR params

        let siteId = '12345';
        let bannerSizes = [
            [300, 250]
        ];
        let country = 'IRL';
        let keywords = 'lifestyle, humour';
        let bidfloorcur = 'EUR';
        let bidfloor = 0.00000011;
        // Set the assets section parameters
        // If you need change the rendering function
        // Client Conf end

        let adUnits = [];

        let PREBID_TIMEOUT = 5000;
        let userIp = 0;
        let userIpLoaded = false;
        let impressionId = hashCode(new Date().getTime().toString());
        let userId = localStorage.getItem('prebidJS.userId');

        if (!userId) {
            localStorage.setItem('prebidJS.userId', hashCode('userId' + new Date().getTime().toString()));
            userId = localStorage.getItem('prebidJS.userId');
        }

        let ipScript = document.createElement('script');
        ipScript.type = 'text/javascript';
        ipScript.src = 'https://api.ipify.org?format=jsonp&callback=userIpCallback';
        document.getElementsByTagName('head')[0].appendChild(ipScript);

        var pbjs = pbjs || {};
        pbjs.que = pbjs.que || [];



        if (isEnabledDebug) {
            onScriptLoaded();
        }

        function onScriptLoaded() {
            pbjs.setConfig({
                debug: isEnabledDebug,
                consentManagement: {
                    gdpr: {
                        cmpApi: 'static',
                        timeout: 1000000,
                        defaultGdprScope: true,
                        consentData: {
                            getTCData: {
                                tcString: consentString,
                                gdprApplies: isGDPRRequested
                            }
                        }
                    }
                }
            });
        }

        // ======== DO NOT EDIT BELOW THIS LINE =========== //
        function userIpCallback(user_ip) {
            userIpLoaded = true;
            if (user_ip.hasOwnProperty('ip')) {
                userIp = user_ip.ip;
            }
        }

        // MurmurHash3 hash function
        function hashCode(str, seed = 0) {
            let h1 = 0xdeadbeef ^ seed, h2 = 0x41c6ce57 ^ seed;
            for (let i = 0, ch; i < str.length; i++) {
                ch = str.charCodeAt(i);
                h1 = Math.imul(h1 ^ ch, 2654435761);
                h2 = Math.imul(h2 ^ ch, 1597334677);
            }
            h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^ Math.imul(h2 ^ (h2 >>> 13), 3266489909);
            h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^ Math.imul(h1 ^ (h1 >>> 13), 3266489909);
            return 4294967296 * (2097151 & h2) + (h1 >>> 0);
        }

        function getAdUnits() {
            return [{
                code: 'native-div',
                mediaTypes: {
                    native: {
                        adTemplate: document.getElementById('native-template').innerHTML,
                        ortb: {
                            assets: [{
                                id: 3,
                                required: 1,
                                title: {
                                    len: 124
                                }
                            },
                            {
                                id: 2,
                                data: {
                                    type: 1,
                                    len: 50
                                }
                            },
                            {
                                id: 1,
                                required: 1,
                                img: {
                                    type: 3,
                                    w: 300,
                                    h: 300
                                }
                            }]
                        }
                    },
                },
                bids: [{
                    bidder: 'exadsadserver',
                    params: {
                        zoneId: zoneId,
                        fid: fid,
                        partner: partner,
                        siteId: siteId,
                        keywords: keywords,
                        userIp: 0, // DO NOT EDIT - Client side data
                        userId: userId,
                        impressionId: impressionId.toString(), // DO NOT EDIT - Custom hash,
                        native: {
                            plcmtcnt: 4,
                        },
                        dsa: {
                            dsarequired: 3,
                            pubrender: 0,
                            datatopub: 2
                        },
                        bidfloor: bidfloor,
                        bidfloorcur: bidfloorcur,
                        country: country,
                        endpoint: exadsEndpoint
                    }
                }]
            }];
        }

        // Init when IP data is available
        function initBids() {
            if (userIpLoaded === false) {
                window.setTimeout(initBids, 50);
            } else {
                adUnits = getAdUnits();

                for (let i = 0; i < adUnits.length; i++) {
                    for (let t = 0; t < adUnits[i].bids.length; t++) {
                        adUnits[i].bids[t].params.userIp = userIp;
                    }
                }

                pbjs.que.push(function () {
                    pbjs.addAdUnits(adUnits);
                    pbjs.requestBids({
                        timeout: PREBID_TIMEOUT,
                        bidsBackHandler: function (bidResponses) {
                            let adServerTargeting = pbjs.getAdserverTargetingForAdUnitCode('native-div');
                            if (adServerTargeting && adServerTargeting['hb_adid']) {
                                Object.entries(bidResponses).forEach(([slot, { bids }]) => {
                                    bids?.length && renderNative(slot, bids[0]);
                                });
                            }
                        }
                    });

                    function renderNative(divId, bid) {
                        const slot = document.getElementById(divId);
                        const content = `
                        <!DOCTYPE html>
                        <html>
                            <body>
                                <script src="https://cdn.jsdelivr.net/npm/prebid-universal-creative@latest/dist/native-render.js"> <\/script>
                                <script>
                                    window.pbNativeData = {
                                        pubUrl: '${encodeURI(document.location)}',
                                        adId: '${bid.adId}',
                                        requestAllAssets: true
                                    };
                                    pbNativeTag.renderNativeAd(pbNativeData);
                                <\/script>
                            </body>
                        </html>
                        `;

                        const iframe = document.createElement('iframe');
                        slot.appendChild(iframe);
                        Object.entries({
                            frameBorder: 0,
                            marginWidth: 0,
                            marginHeight: 0,
                            srcdoc: content
                        }).forEach(([prop, val]) => iframe.setAttribute(prop, val));
                    }
                });
            }
        }

        initBids();

    </script>

</head>

<body>
    <template id="native-template">
        <style>
            body {
                display: inline-block;
            }

            .container {
                display: inline-block;
                font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
                font-size: 14px;
                line-height: 1.42857143;
                color: #333;
                background: #fff url(##hb_native_image##) no-repeat center;
                background-size: cover;
            }


            .card {
                border: 4px solid #ffd724;
                display: inline-block;
                padding: 20px;
                height: 300px;
                width: 320px;
            }


            h1 a:link,
            a:active,
            a:visited,
            a:hover,
            a:focus {
                text-decoration: none;
                color: #fff;
            }

            h1 {
                line-height: 1.3;
                color: #fff;
                font-size: 26px;
                background-color: rgba(0, 0, 0, 0.7);
                display: inline;
                font-family: Roboto, serif;
                font-weight: 100;
            }

            .attribution {
                color: #fff;
                display: inline-block;
                letter-spacing: 2px;
                background-color: #ffd724;
                font-size: 12px;
                line-height: 1;
                padding: 6px 6px 0 6px;
                margin: 5px 0 10px 0;
                border-radius: 4px;
            }
        </style>
        <div class="container">
            <div class="card">
                <div class="title">
                    <h1>
                        <a href="##hb_native_linkurl##" target="_blank">##hb_native_title##</a>
                    </h1>
                </div>
                <div class="attribution">
                    <p>##hb_native_body##</p>
                </div>
            </div>
        </div>
    </template>

    <h2>RTB Native Prebid.js</h2>
    <div id='native-div'>
        No ADS
    </div>
</body>

</html>